<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ãƒ†ã‚­ã‚¹ãƒˆãŠé¡Œ - Aquarium</title>

  <link rel="stylesheet" href="style.css" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=M+PLUS+1p:wght@300;400&family=Shippori+Mincho:wght@400;500&display=swap"
    rel="stylesheet"
  />
</head>
<body>

  <div class="container">
    <header>
      <div class="icon-area-small">
        <!-- ã“ã“ã¯ç”»åƒã˜ã‚ƒãªããƒ­ã‚´æ–‡å­—ã«ã—ã¦ã‚‹ç‰ˆ -->
        <div class="site-logo">Aquarium</div>
      </div>

      <button class="url-copy-button" type="button" onclick="copyPageUrl(this)">
        ã“ã®ãƒšãƒ¼ã‚¸ã®URLã‚’ã‚³ãƒ”ãƒ¼
      </button>

      <h1>ãƒ†ã‚­ã‚¹ãƒˆãŠé¡Œ</h1>
      <p class="bio">ã‚¿ã‚¤ãƒˆãƒ«ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨é–‹ãã‚ˆã€‚</p>
      <a href="index.html" class="back-link">â† æ°´æ§½ã«æˆ»ã‚‹</a>
    </header>

    <main>
      <section class="prompt-list" id="promptList">
        <p id="loading">èª­ã¿è¾¼ã¿ä¸­â€¦</p>
      </section>
    </main>

    <footer>
      <small>&copy; 2025 Sakana</small>
    </footer>
  </div>

  <!-- ãŠé¡Œãƒ‡ãƒ¼ã‚¿ï¼ˆã“ã‚Œã‚’ç·¨é›†ã—ã¦å¢—ã‚„ã™ï¼‰ -->
  <script src="prompts-text.js"></script>

  <script>
    function renderPrompts(prompts) {
      const list = document.getElementById("promptList");
      const loading = document.getElementById("loading");
      if (loading) loading.remove();

      const frag = document.createDocumentFragment();

      for (const p of prompts) {
        const details = document.createElement("details");
        details.className = "prompt-box";

        // â˜… ãŠé¡Œã”ã¨ã®IDï¼ˆãªã„å ´åˆã¯è‡ªå‹•ç”Ÿæˆï¼‰
        const pid = p.id || ("prompt-" + Math.random().toString(36).slice(2));
        details.id = pid;

        const summary = document.createElement("summary");
        summary.textContent = p.title || "ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ãªã—ï¼‰";

        const content = document.createElement("div");
        content.className = "prompt-content";

        // èª¬æ˜
        if (p.desc) {
          const descP = document.createElement("p");
          descP.innerHTML = String(p.desc).replaceAll("\n", "<br>");
          content.appendChild(descP);
        }

        // â˜… ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚’â€œã¾ã¨ã‚ã‚‹ç®±â€
        const actions = document.createElement("div");
        actions.className = "prompt-actions";

// ãƒœã‚¿ãƒ³ã¾ã¨ã‚ç”¨ãƒ©ãƒƒãƒ‘ãƒ¼
const actions = document.createElement("div");
actions.className = "prompt-actions";

// noteè¨˜äº‹ãƒœã‚¿ãƒ³
if (p.link) {
  const a = document.createElement("a");
  a.href = p.link;
  a.target = "_blank";
  a.rel = "noopener noreferrer";
  a.className = "mini-btn note-btn";
  a.textContent = "ğŸ—’ï¸ noteè¨˜äº‹ã‚’èª­ã‚€";
  actions.appendChild(a);
}

// URLã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³
const linkBtn = document.createElement("button");
linkBtn.className = "mini-btn url-mini";
linkBtn.type = "button";
linkBtn.textContent = "ã“ã®ãŠé¡Œã®URLã‚’ã‚³ãƒ”ãƒ¼";
linkBtn.onclick = () => copyPromptUrl(pid, linkBtn);
actions.appendChild(linkBtn);

content.appendChild(actions);ã‚

        // æœ¬æ–‡ï¼ˆã‚³ãƒ”ãƒ¼æ¬„ï¼‰
        if (p.body) {
          const copy = document.createElement("div");
          copy.className = "copy-container";

          const ta = document.createElement("textarea");
          ta.readOnly = true;
          ta.value = p.body;

          const btn = document.createElement("button");
          btn.type = "button";
          btn.textContent = "ã‚³ãƒ”ãƒ¼ã™ã‚‹";
          btn.onclick = function () { copyPrompt(btn); };

          copy.appendChild(ta);
          copy.appendChild(btn);
          content.appendChild(copy);
        }

        // â˜… é–‹é–‰ã•ã‚ŒãŸã‚‰ã€ãã®ãŠé¡Œã®ãƒãƒƒã‚·ãƒ¥ã‚’URLã«åæ˜ 
        details.addEventListener("toggle", () => {
          if (details.open) {
            history.replaceState(null, "", "#" + pid);
          }
        });

        details.appendChild(summary);
        details.appendChild(content);
        frag.appendChild(details);
      }

      list.appendChild(frag);
    }

    // ã“ã®ãƒšãƒ¼ã‚¸ã®URLã‚’ã‚³ãƒ”ãƒ¼
    function copyPageUrl(button) {
      const url = location.href;
      copyToClipboard(url, button);
    }

    // ã“ã®ãŠé¡Œã®URLã‚’ã‚³ãƒ”ãƒ¼ï¼ˆ#idã¤ãï¼‰
    function copyPromptUrl(promptId, button) {
      const url = location.origin + location.pathname + "#" + promptId;
      copyToClipboard(url, button);
    }

    // å…±é€šã‚³ãƒ”ãƒ¼å‡¦ç†ï¼ˆæˆåŠŸè¡¨ç¤ºã‚‚ã“ã“ã§çµ±ä¸€ï¼‰
    function copyToClipboard(text, button) {
      const done = () => {
        const original = button.textContent;
        button.textContent = "ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼";
        button.classList.add("copied");
        setTimeout(() => {
          button.textContent = original;
          button.classList.remove("copied");
        }, 2000);
      };

      if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(text).then(done).catch(() => fallbackCopy(text, done));
      } else {
        fallbackCopy(text, done);
      }
    }

    function fallbackCopy(text, done) {
      const temp = document.createElement("textarea");
      temp.value = text;
      document.body.appendChild(temp);
      temp.select();
      document.execCommand("copy");
      document.body.removeChild(temp);
      done();
    }

    // æœ¬æ–‡ã‚³ãƒ”ãƒ¼ï¼ˆtextareaã®å†…å®¹ï¼‰
    function copyPrompt(button) {
      const textarea = button.previousElementSibling;
      const text = textarea.value;
      copyToClipboard(text, button);
    }

    // æç”»
    renderPrompts(window.PROMPTS_TEXT || []);

    // ãƒãƒƒã‚·ãƒ¥ãŒã‚ã‚Œã°ã€ãã®ãŠé¡Œã‚’é–‹ãï¼ˆãƒšãƒ¼ã‚¸ç›´ãƒªãƒ³ã‚¯å¯¾å¿œï¼‰
    const hash = location.hash.replace("#", "");
    if (hash) {
      const target = document.getElementById(hash);
      if (target && target.tagName.toLowerCase() === "details") {
        target.open = true;
        target.scrollIntoView({ behavior: "smooth", block: "start" });
      }
    }
  </script>

</body>
</html>