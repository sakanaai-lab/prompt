<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ãƒ†ã‚­ã‚¹ãƒˆãŠé¡Œ - Aquarium</title>

  <link rel="stylesheet" href="style.css" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=M+PLUS+1p:wght@300;400&family=Shippori+Mincho:wght@400;500&display=swap" rel="stylesheet" />
</head>
<body>

<div class="container">
  <header>

    <div class="icon-area-small">
      <div class="site-logo">Aquarium</div>
    </div>

    <a href="javascript:void(0)"
       class="url-copy-button"
       role="button"
       onclick="copyPageUrl(this)">
      ã“ã®ãƒšãƒ¼ã‚¸ã®URLã‚’ã‚³ãƒ”ãƒ¼
    </a>

    <h1>ãƒ†ã‚­ã‚¹ãƒˆãŠé¡Œ</h1>
    <p class="bio">ã‚¿ã‚¤ãƒˆãƒ«ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨é–‹ãã‚ˆã€‚</p>
    <a href="index.html" class="back-link">â† æ°´æ§½ã«æˆ»ã‚‹</a>

  </header>

  <main>
    <section class="prompt-list" id="promptList">
      <p id="loading">èª­ã¿è¾¼ã¿ä¸­â€¦</p>
    </section>
  </main>

  <footer>
    <small>&copy; 2025 Sakana</small>
  </footer>
</div>

<!-- ãŠé¡Œãƒ‡ãƒ¼ã‚¿ -->
<script src="prompts-text.js"></script>

<script>
  function renderPrompts(prompts) {
    const list = document.getElementById("promptList");
    const loading = document.getElementById("loading");
    if (loading) loading.remove();

    const frag = document.createDocumentFragment();

    for (const p of prompts) {
      const details = document.createElement("details");
      details.className = "prompt-box";

      // ãŠé¡ŒIDï¼ˆå¿…é ˆã€‚ç„¡ã„ã¨ãã¯ç”Ÿæˆï¼‰
      const pid = p.id || ("prompt-" + Math.random().toString(36).slice(2));
      details.id = pid;

      const summary = document.createElement("summary");
      summary.textContent = p.title;

      const content = document.createElement("div");
      content.className = "prompt-content";

      if (p.desc) {
        const descP = document.createElement("p");
        descP.className = "prompt-desc";
        descP.innerHTML = String(p.desc).replaceAll("\n", "<br>");
        content.appendChild(descP);
      }

      // â˜… ãƒœã‚¿ãƒ³è¡Œï¼ˆnote + URLã‚³ãƒ”ãƒ¼ã‚’1è¡Œã«ï¼‰
      const actions = document.createElement("div");
      actions.className = "prompt-actions";

   // ãƒœã‚¿ãƒ³ã¾ã¨ã‚ç”¨ã®ç®±
const actions = document.createElement("div");
actions.className = "prompt-actions";

// noteè¨˜äº‹ãƒœã‚¿ãƒ³
if (p.link) {
  const a = document.createElement("a");
  a.href = p.link;
  a.target = "_blank";
  a.rel = "noopener noreferrer";
  a.className = "mini-btn";
  a.textContent = "ğŸ—’ï¸ note";
  actions.appendChild(a);
}

// URLã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³
const linkBtn = document.createElement("button");
linkBtn.className = "mini-btn";
linkBtn.type = "button";
linkBtn.textContent = "ã“ã®ãŠé¡Œã®URLã‚’ã‚³ãƒ”ãƒ¼";
linkBtn.onclick = () => copyPromptUrl(pid, linkBtn);
actions.appendChild(linkBtn);

// ã¾ã¨ã‚ã¦è¿½åŠ 
content.appendChild(actions);

      // æœ¬æ–‡ï¼ˆã‚³ãƒ”ãƒ¼æ ï¼‰
      if (p.body) {
        const copy = document.createElement("div");
        copy.className = "copy-container wide";

        const ta = document.createElement("textarea");
        ta.readOnly = true;
        ta.textContent = p.body;

        const btn = document.createElement("button");
        btn.textContent = "ã‚³ãƒ”ãƒ¼ã™ã‚‹";
        btn.onclick = function () { copyPrompt(btn); };

        copy.appendChild(ta);
        copy.appendChild(btn);
        content.appendChild(copy);
      }

      // é–‹é–‰ã§URLã«ãƒãƒƒã‚·ãƒ¥åæ˜ ï¼ˆå…±æœ‰ã—ã‚„ã™ã„ï¼‰
      details.addEventListener("toggle", () => {
        if (details.open) history.replaceState(null, "", "#" + pid);
      });

      details.appendChild(summary);
      details.appendChild(content);
      frag.appendChild(details);
    }

    list.appendChild(frag);
  }

  function copyPageUrl(button) {
    const url = location.href;

    const done = () => {
      const original = button.textContent;
      button.textContent = "ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼";
      button.classList.add("copied");
      setTimeout(() => {
        button.textContent = original;
        button.classList.remove("copied");
      }, 2000);
    };

    if (navigator.clipboard && window.isSecureContext) {
      navigator.clipboard.writeText(url).then(done).catch(() => {
        fallbackCopy(url); done();
      });
    } else {
      fallbackCopy(url); done();
    }
  }

  function copyPromptUrl(promptId, button) {
    const url = location.origin + location.pathname + "#" + promptId;

    const done = () => {
      const original = button.textContent;
      button.textContent = "ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼";
      button.classList.add("copied");
      setTimeout(() => {
        button.textContent = original;
        button.classList.remove("copied");
      }, 2000);
    };

    if (navigator.clipboard && window.isSecureContext) {
      navigator.clipboard.writeText(url).then(done).catch(() => {
        fallbackCopy(url); done();
      });
    } else {
      fallbackCopy(url); done();
    }
  }

  function fallbackCopy(text) {
    const temp = document.createElement("textarea");
    temp.value = text;
    document.body.appendChild(temp);
    temp.select();
    document.execCommand("copy");
    document.body.removeChild(temp);
  }

  function copyPrompt(button) {
    const textarea = button.previousElementSibling;
    textarea.select();
    textarea.setSelectionRange(0, 99999);

    const done = () => {
      const original = button.textContent;
      button.textContent = "ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼";
      button.classList.add("copied");
      setTimeout(() => {
        button.textContent = original;
        button.classList.remove("copied");
      }, 2000);
    };

    if (navigator.clipboard && window.isSecureContext) {
      navigator.clipboard.writeText(textarea.value).then(done).catch(() => {
        document.execCommand("copy"); done();
      });
    } else {
      document.execCommand("copy"); done();
    }
  }

  renderPrompts(window.PROMPTS_TEXT || []);

  // ãƒãƒƒã‚·ãƒ¥ãŒã‚ã‚Œã°è©²å½“ãŠé¡Œã‚’é–‹ã
  const hash = location.hash.replace("#", "");
  if (hash) {
    const target = document.getElementById(hash);
    if (target && target.tagName.toLowerCase() === "details") {
      target.open = true;
      target.scrollIntoView({ behavior: "smooth", block: "start" });
    }
  }
</script>

</body>
</html>