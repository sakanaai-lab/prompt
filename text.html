<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>テキストお題 - Aquarium</title>

  <link rel="stylesheet" href="style.css" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=M+PLUS+1p:wght@300;400&family=Shippori+Mincho:wght@400;500&display=swap" rel="stylesheet" />
</head>
<body>

<div class="container">
  <header>

    <div class="icon-area-small">
      <div class="site-logo">
  Aquarium
</div>
    </div>

    <a href="javascript:void(0)"
       class="url-copy-button"
       role="button"
       onclick="copyPageUrl(this)">
      このページのURLをコピー
    </a>

    <h1>テキストお題</h1>
    <p class="bio">タイトルをタップすると開くよ。</p>
    <a href="index.html" class="back-link">← 水槽に戻る</a>

  </header>

    <main>
      <section class="prompt-list" id="promptList">
        <p id="loading">読み込み中…</p>
      </section>
    </main>

    <footer>
      <small>&copy; 2025 Sakana</small>
    </footer>
  </div>

  <!-- お題データ（これを編集して増やす） -->
  <script src="prompts-text.js"></script>

  <!-- 表示用スクリプト（ここは基本いじらない） -->
  <script>
    function renderPrompts(prompts) {
      const list = document.getElementById("promptList");
      const loading = document.getElementById("loading");
      if (loading) loading.remove();

      const frag = document.createDocumentFragment();

for (const p of prompts) {
  const details = document.createElement("details");
  details.className = "prompt-box";

  // ★ お題ごとのID（ない場合は適当に作る）
  const pid = p.id || ("prompt-" + Math.random().toString(36).slice(2));
  details.id = pid;

  const summary = document.createElement("summary");
  summary.textContent = p.title;

  const content = document.createElement("div");
  content.className = "prompt-content";

  if (p.desc) {
    const descP = document.createElement("p");
    descP.innerHTML = String(p.desc).replaceAll("\n", "<br>");
    content.appendChild(descP);
  }
  
  // ★ note記事リンクがある場合だけ「記事を読む」ボタンを出す
  if (p.link) {
  const a = document.createElement("a");
  a.href = p.link;
  a.target = "_blank";
  a.rel = "noopener noreferrer";
  a.className = "note-link-button";
  a.textContent = "note記事を読む";
  content.appendChild(a);
}

  // ★ お題ごとのURLコピーボタン（本文の上でも下でも好きな位置）
  const linkBtn = document.createElement("button");
  linkBtn.className = "url-copy-button";
  linkBtn.type = "button";
  linkBtn.textContent = "このお題のURLをコピー";
  linkBtn.onclick = function () { copyPromptUrl(pid, linkBtn); };
  content.appendChild(linkBtn);

  if (p.body) {
    const copy = document.createElement("div");
    copy.className = "copy-container";

    const ta = document.createElement("textarea");
    ta.readOnly = true;
    ta.textContent = p.body;

    const btn = document.createElement("button");
    btn.textContent = "コピーする";
    btn.onclick = function () { copyPrompt(btn); };

    copy.appendChild(ta);
    copy.appendChild(btn);
    content.appendChild(copy);
  }

  // ★ 開閉されたら、そのお題のハッシュをURLに反映
  details.addEventListener("toggle", () => {
    if (details.open) {
      history.replaceState(null, "", "#" + pid);
    }
  });

  details.appendChild(summary);
  details.appendChild(content);
  frag.appendChild(details);
}
function copyPromptUrl(promptId, button) {
  const url = location.origin + location.pathname + "#" + promptId;

  const done = () => {
    const original = button.textContent;
    button.textContent = "コピーしました！";
    button.classList.add("copied");
    setTimeout(() => {
      button.textContent = original;
      button.classList.remove("copied");
    }, 2000);
  };

  if (navigator.clipboard && window.isSecureContext) {
    navigator.clipboard.writeText(url).then(done).catch(() => {
      document.execCommand("copy");
      done();
    });
  } else {
    const temp = document.createElement("textarea");
    temp.value = url;
    document.body.appendChild(temp);
    temp.select();
    document.execCommand("copy");
    document.body.removeChild(temp);
    done();
  }
}
      
      list.appendChild(frag);
    }

    function copyPrompt(button) {
      const textarea = button.previousElementSibling;
      textarea.select();
      textarea.setSelectionRange(0, 99999);

      const done = () => {
        const original = button.textContent;
        button.textContent = "コピーしました！";
        button.classList.add("copied");
        setTimeout(() => {
          button.textContent = original;
          button.classList.remove("copied");
        }, 2000);
      };

      if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(textarea.value).then(done).catch(() => {
          document.execCommand("copy");
          done();
        });
      } else {
        document.execCommand("copy");
        done();
      }
    }

    renderPrompts(window.PROMPTS_TEXT || []);
    // ハッシュがあれば、そのお題を開く
const hash = location.hash.replace("#", "");
if (hash) {
  const target = document.getElementById(hash);
  if (target && target.tagName.toLowerCase() === "details") {
    target.open = true;
    target.scrollIntoView({ behavior: "smooth", block: "start" });
  }
}
  </script>

</body>
</html>
